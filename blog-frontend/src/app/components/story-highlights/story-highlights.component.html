<div class="stories-container">
  <div class="stories-header">
    <h4>{{ 'highlights' | translate }}</h4>
  </div>

  <!-- Yükleniyor göstergesi -->
  <div *ngIf="isLoading" class="stories-loading">
    <div class="spinner-border spinner-border-sm" role="status">
      <span class="visually-hidden">{{ 'loading' | translate }}</span>
    </div>
  </div>

  <!-- Hata mesajı -->
  <div *ngIf="error" class="stories-error">
    {{ error }}
  </div>

  <!-- Öne çıkan içerikler - Kullanıcı Gruplarına Göre -->
  <div *ngIf="!isLoading && !error" class="stories-wrapper">
    <div class="stories-list">
      <!-- Kullanıcı Avatarları - Öne Çıkan İçerikleri Olan Kullanıcılar -->
      <div *ngFor="let user of userHighlights" class="story-item" (click)="showUserHighlights(user)" [title]="user.userName">
        <div class="story-avatar" [ngClass]="{'seen': areAllHighlightsSeen(user)}">
          <!-- Kullanıcı profil resmi dışarıda görünecek -->
          <img 
            [src]="user.userProfileImage" 
            [alt]="user.userName" 
            class="story-avatar-img"
            (error)="user.userProfileImage = 'assets/images/default-avatar.jpg'"
            loading="lazy">
          
          <!-- Görüntülenmemiş içerikler için indikatör -->
          <div *ngIf="hasUnseenHighlights(user)" class="unseen-indicator"></div>
        </div>
        <!-- Kullanıcı ismi gösteriliyor -->
        <span class="story-username">{{ user.userName }}</span>
      </div>

      <!-- Öne çıkan içerik yoksa -->
      <div *ngIf="userHighlights.length === 0" class="no-stories">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
          <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
        </svg>
        <span>{{ 'no_highlights' | translate }}</span>
      </div>
    </div>
  </div>
  
  <!-- Öne Çıkan İçerikler Dialog'u -->
  <div *ngIf="showDialog && selectedUser" class="story-dialog-backdrop" (click)="closeDialog()">
    <div class="story-dialog" (click)="$event.stopPropagation()">
      <!-- Dialog Header - Kullanıcı Bilgileri -->
      <div class="dialog-header">
        <div class="user-info">
          <img [src]="selectedUser.userProfileImage" 
               [alt]="selectedUser.userName" 
               class="user-avatar"
               (error)="selectedUser.userProfileImage = 'assets/images/default-avatar.jpg'"
               loading="lazy">
          <div class="user-details">
            <span class="user-name">{{ selectedUser.userName }}</span>
            <span class="post-time">{{ selectedUser.highlights[selectedHighlightIndex].title }}</span>
          </div>
        </div>
        <button class="close-btn" (click)="closeDialog()">×</button>
      </div>
      
      <!-- Dialog Content - İçerik Görünümü -->
      <div class="dialog-content">
        <!-- Timeline Göstergesi -->
        <div class="timeline-container">
          <div *ngFor="let highlight of selectedUser.highlights; let i = index" 
               class="timeline-item" 
               [class.active]="i === selectedHighlightIndex">
          </div>
        </div>
        
        <!-- Post İçeriği -->
        <div class="post-content" *ngIf="selectedUser.highlights.length > 0 && selectedHighlightIndex < selectedUser.highlights.length">
          <!-- Post resmi için hata kontrolü -->
          <div *ngIf="!selectedUser.highlights[selectedHighlightIndex].coverImage" class="no-image-placeholder">
            <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" viewBox="0 0 16 16">
              <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
              <path d="M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13zm13 1a.5.5 0 0 1 .5.5v6l-3.775-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.577.076L.939 11.3a.5.5 0 0 0-.121.307v.5a.5.5 0 0 0 .121.307l3.464 3.464h9.592a.5.5 0 0 0 .5-.5V3.5a.5.5 0 0 0-.5-.5h-13z"/>
            </svg>
            <span>{{ 'no_image_available' | translate }}</span>
          </div>
          
          <!-- Post resmi varsa göster -->
          <img *ngIf="selectedUser.highlights[selectedHighlightIndex].coverImage"
            [src]="selectedUser.highlights[selectedHighlightIndex].coverImage" 
            [alt]="selectedUser.highlights[selectedHighlightIndex].title"
            class="post-image"
            (click)="viewHighlight(selectedUser.highlights[selectedHighlightIndex])"
            (error)="handlePostImageError(selectedHighlightIndex)"
            loading="lazy">
            
          <div class="post-title">
            {{ selectedUser.highlights[selectedHighlightIndex].title }}
          </div>
          
          <button class="view-btn" (click)="viewHighlight(selectedUser.highlights[selectedHighlightIndex])" [title]="'view_post' | translate">
            Devamını Oku
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
            </svg>
          </button>
        </div>
        
        <!-- Önceki / Sonraki Butonları -->
        <button *ngIf="selectedHighlightIndex > 0" 
                class="nav-btn prev-btn" 
                (click)="prevHighlight()">
          &#10094;
        </button>
        
        <button *ngIf="selectedUser.highlights.length > 0 && selectedHighlightIndex < selectedUser.highlights.length - 1" 
                class="nav-btn next-btn" 
                (click)="nextHighlight()">
          &#10095;
        </button>
      </div>
    </div>
  </div>
</div> 